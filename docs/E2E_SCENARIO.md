# E2E Test Scenarios

## 画像アップロード API テスト (/api/upload)

### 認証・セッション
- 認証なしでアップロードを拒否する (401)
- 期限切れのセッションでアップロードを拒否する (401)

### ファイル検証
- ファイルなしでアップロードを拒否する (400)
- 無効なファイル形式（text/plainなど）を拒否する (400)
- ファイルサイズ超過（2MBより大きい）を拒否する (400)
- 境界値テスト: 2MBちょうどのファイルを許可する (200)
- 境界値テスト: 2MB + 1バイトのファイルを拒否する (400)

### 有効なファイル形式
- JPEG画像を正常にアップロードする (200)
- PNG画像を正常にアップロードする (200)
- GIF画像を正常にアップロードする (200)
- WebP画像を正常にアップロードする (200)

## カード削除 UI テスト

### 削除操作
- 確認ダイアログありでカードを削除する
  - ダッシュボードから新規カード追加
  - カードが表示されることを確認
  - 削除ボタンをクリック（ホバーして表示）
  - 確認ダイアログで「OK」を選択
  - カードがUIから削除されることを確認

### エラーハンドリング
- ネットワークエラー時にエラーを表示する
  - API呼び出しをモックして失敗させる
  - 削除ボタンをクリック
  - エラーダイアログが表示されることを確認
  - カードが削除されないことを確認

### キャンセル操作
- 確認ダイアログでキャンセルした場合、カードを削除しない
  - 削除ボタンをクリック
  - 確認ダイアログで「キャンセル」を選択
  - カードが表示されたままであることを確認

## 画像アップロード UI テスト

### フォーム表示
- 新規カード追加時にアップロードフォームを表示する
  - 「新規カード追加」ボタンをクリック
  - フォーム、ファイル入力、ラベルが表示されることを確認

### ファイル検証
- ファイルサイズ超過時のバリデーション
  - 3MBのファイルを選択
  - 名前を入力して送信
  - 「Failed to upload」エラーダイアログが表示されることを確認

- 無効なファイル形式のバリデーション
  - .txtファイルを選択
  - 名前を入力して送信
  - 「Failed to upload」エラーダイアログが表示されることを確認

### 画像フォーマット別の正常アップロード
- JPEG画像を正常にアップロードしてカードを作成
  - 画像ファイルを選択
  - カード名、説明、レアリティを入力
  - 送信ボタンをクリック
  - フォームが閉じ、カードが表示されることを確認

- PNG画像を正常にアップロードしてカードを作成
  - JPEGと同じフローでPNG形式をテスト

- GIF画像を正常にアップロードしてカードを作成
  - JPEGと同じフローでGIF形式をテスト

- WebP画像を正常にアップロードしてカードを作成
  - JPEGと同じフローでWebP形式をテスト

### カード更新
- 既存カードの画像を更新する
  - 新規カードを作成
  - 編集ボタンをクリック（ホバーして表示）
  - 新しい画像を選択
  - 送信
  - カードが更新されたことを確認

### 画像なしのカード作成
- 画像なしでカードを作成
  - 名前、説明、レアリティのみを入力
  - 送信
  - カードが表示されることを確認

### エラーハンドリング
- アップロードエラーを適切に処理
  - /api/uploadエンドポイントをモックして500エラーを返す
  - 画像をアップロード
  - フォームが表示されたままであることを確認

### ローディング状態
- アップロード中にローディング状態を表示
  - /api/uploadエンドポイントをモックして遅延させる
  - 送信ボタンをクリック
  - 「保存中...」ボタンが表示されることを確認

### キャンセル操作
- カード作成をキャンセル
  - 情報を入力
  - 「キャンセル」ボタンをクリック
  - フォームが閉じ、カードが作成されないことを確認

### 境界値テスト
- 2MBちょうどのファイルを正常にアップロード
  - 2MBのファイルを選択
  - 名前を入力して送信
  - カードが作成されることを確認（タイムアウト15秒）

---

## テスト環境設定

### 事前条件
- ローカル開発サーバーが http://localhost:3000 で稼働中
- Supabaseデータベースが利用可能
- テスト用ストリーマーアカウント (twitch_user_id: 123456789) がセットアップ済み

### 認証モック
- テストセッションクッキーを使用した認証
- セッション有効期限: 1時間

### テストデータのセットアップ
- 各テスト前にテスト用ストリーマーのカードを削除

---

## 注意事項

### 実装されていない機能
- MIME type header validation（APIはfile.typeから検証）

### セキュリティ考慮事項
- ファイルコンテンツの検証は個別に実装が必要

### タイムアウト設定
- デフォルト: Playwrightのデフォルトタイムアウト
- 境界値テスト: 15秒

---

## テストフレームワーク

- Playwright
- 複数ブラウザ対応（Chromium, Firefox, WebKit）
- 並列実行（CI環境ではワーカー1）
- リトライ（CI環境では2回）
